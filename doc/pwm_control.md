# pwm_control
### フローチャート
<details><summary>表示</summary><div>

<br>

***※太字斜体下線の文字列はパラメータで設定する値***

![](img/flow_chart/pwm_control.svg)
* A : 出力デューティー比を既定の範囲内に収める処理．
* B : 「有効化」が 0 だったチャンネルはモータを駆動しない．誤作動を防ぐために，***使用しないチャンネルの「有効化」は 0 にすること．***
* C : MD への信号に変更を反映する処理．
    * この関数の内部で出力デューティー比の大きさを 100 以下に収める処理が行われている．
</details></div>

### 通信データ ( M->S )
    1. 書き込み禁止
    2. PWM1 ( -100 ～ 100 )
    3. PWM2 ( -100 ～ 100 )
    4. －
    5. －
### 通信データ ( S->M )
    1. －
### パラメータ
    1. 有効化 ( 0 or 1 )
    2. PWM 最大値 ( 1 ～ 100 )
<details><summary>詳細</summary><div>

* 有効化
    * 使用するときは 1 にする．
    * 使用しないときは 0 にしておく．
    * ***使用しないのに 1 にしおくと，エンコーダのコネクタから乗ったノイズによって誤動作が起こる可能性がある．***
* PWM 最大値
    * 制御基板から出力する PWM 波形 のデューティー比の最大値
    * 「PWM 最大値」よりも大きな値がマスターから指定された場合は，「PWM 最大値」が代わりに使用される
    * 極力小さな値を指定することで，マスター側のプログラムに不具合が生じてもモータの暴走を防ぐことができる
</div></details>

### 使用している周辺モジュール
|モジュール名|用途|
|:-|:-|
|UART1(TX, RX)|マスターとの通信|
|Timer2       |OC 用|
|OC1, OC2     |DC モータを制御するための PWM|

# 改善点
* 加減速処理を追加して欲しい．
    * rotation_angle_control の PARAM_MAX_PWM_CHANGE のようなパラメータを用意して pwm_control の内部で加減速処理を行う．
* マスターでの加減速処理が不要になるからとても便利だと思う．
* revolution_control のプログラムを使いまわしたら楽だと思う
    * 50ms 周期のタイマ割り込みが設定されているから