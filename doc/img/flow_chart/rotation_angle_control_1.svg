<svg id="レイヤー_1" data-name="レイヤー 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 881.33 595.28"><defs><style>.cls-1,.cls-4{fill:#fff;}.cls-16,.cls-17,.cls-18,.cls-19,.cls-2,.cls-20,.cls-21,.cls-22,.cls-23,.cls-24,.cls-25,.cls-26,.cls-27,.cls-28,.cls-29,.cls-30{fill:none;}.cls-16,.cls-17,.cls-2,.cls-4{stroke:#231815;}.cls-16,.cls-17,.cls-18,.cls-19,.cls-2,.cls-20,.cls-21,.cls-22,.cls-23,.cls-24,.cls-25,.cls-26,.cls-27,.cls-28,.cls-29,.cls-30,.cls-4{stroke-miterlimit:10;}.cls-11,.cls-12,.cls-15,.cls-3,.cls-5,.cls-8{fill:#231815;}.cls-11,.cls-12,.cls-5,.cls-8{font-size:11px;}.cls-10,.cls-12,.cls-5{font-family:Meiryo, Meiryo;}.cls-6,.cls-8{font-family:Meiryo-BoldItalic, Meiryo;}.cls-31,.cls-6,.cls-9{font-weight:700;}.cls-6,.cls-9{font-style:italic;text-decoration:underline;}.cls-7{letter-spacing:2.93em;}.cls-11{font-family:KozGoPr6N-Regular-90ms-RKSJ-H, Kozuka Gothic Pr6N;}.cls-12{letter-spacing:0.02em;}.cls-13{letter-spacing:0.27em;}.cls-14,.cls-15{letter-spacing:0.02em;}.cls-16{stroke-dasharray:7.07 7.07;}.cls-17{stroke-dasharray:6.87 6.87;}.cls-18,.cls-19,.cls-20,.cls-21,.cls-22,.cls-23,.cls-24,.cls-25,.cls-26,.cls-27,.cls-28,.cls-29,.cls-30{stroke:#e60012;stroke-width:0.5px;}.cls-19{stroke-dasharray:7.06 7.06;}.cls-20{stroke-dasharray:7.19 7.19;}.cls-21{stroke-dasharray:7.1 7.1;}.cls-22{stroke-dasharray:6.86 6.86;}.cls-23{stroke-dasharray:7.01 7.01;}.cls-24{stroke-dasharray:6.9 6.9;}.cls-25{stroke-dasharray:7.06 7.06;}.cls-26{stroke-dasharray:7.02 7.02;}.cls-27{stroke-dasharray:7.01 7.01;}.cls-28{stroke-dasharray:7.25 7.25;}.cls-29{stroke-dasharray:6.86 6.86;}.cls-30{stroke-dasharray:7.29 7.29;}.cls-31{font-size:12px;fill:#e60012;font-family:Meiryo-Bold, Meiryo;}</style></defs><title>アートボード 1</title><rect class="cls-1" x="0.54" y="0.1" width="880.62" height="595.15"/><line class="cls-2" x1="159.95" y1="68.02" x2="159.95" y2="44.16"/><polygon class="cls-3" points="163.13 62.11 162.19 61.77 159.95 67.92 157.71 61.77 156.77 62.11 159.95 70.85 163.13 62.11"/><line class="cls-2" x1="159.95" y1="109.37" x2="159.95" y2="70.85"/><polygon class="cls-3" points="163.13 103.46 162.19 103.12 159.95 109.28 157.71 103.12 156.77 103.46 159.95 112.2 163.13 103.46"/><line class="cls-2" x1="159.95" y1="149.72" x2="159.95" y2="112.2"/><polygon class="cls-3" points="163.13 143.81 162.19 143.47 159.95 149.63 157.71 143.47 156.77 143.81 159.95 152.55 163.13 143.81"/><line class="cls-2" x1="159.95" y1="285.87" x2="159.95" y2="152.55"/><polygon class="cls-3" points="163.13 279.96 162.19 279.62 159.95 285.77 157.71 279.62 156.77 279.96 159.95 288.69 163.13 279.96"/><line class="cls-2" x1="159.95" y1="325.22" x2="159.95" y2="288.69"/><polygon class="cls-3" points="163.13 319.31 162.19 318.97 159.95 325.12 157.71 318.97 156.77 319.31 159.95 328.05 163.13 319.31"/><line class="cls-2" x1="159.95" y1="385.79" x2="159.95" y2="328.05"/><polygon class="cls-3" points="163.13 379.88 162.19 379.54 159.95 385.69 157.71 379.54 156.77 379.88 159.95 388.62 163.13 379.88"/><line class="cls-2" x1="159.95" y1="500.49" x2="159.95" y2="388.62"/><polygon class="cls-3" points="163.13 494.58 162.19 494.24 159.95 500.39 157.71 494.24 156.77 494.58 159.95 503.31 163.13 494.58"/><rect class="cls-4" x="29.62" y="328.05" width="260.66" height="44.5"/><text class="cls-5" transform="translate(38.86 343.54)">pwm ← <tspan class="cls-6" x="44.89" y="0">比例ゲイン</tspan><tspan x="99.89" y="0" xml:space="preserve"> × 0.001 × cnt_diff </tspan><tspan class="cls-7" x="0" y="19.25" xml:space="preserve">		</tspan><tspan x="72" y="19.25">+ </tspan><tspan class="cls-6" x="84.58" y="19.25">PWM 最小値</tspan><tspan x="150.41" y="19.25" xml:space="preserve"> × sgn( cnt_diff )</tspan></text><line class="cls-2" x1="159.95" y1="551.84" x2="159.95" y2="503.31"/><polygon class="cls-3" points="163.13 545.93 162.19 545.59 159.95 551.74 157.71 545.59 156.77 545.93 159.95 554.66 163.13 545.93"/><line class="cls-2" x1="443.06" y1="65.7" x2="443.06" y2="52.66"/><polygon class="cls-3" points="446.24 59.79 445.3 59.45 443.06 65.61 440.82 59.45 439.88 59.79 443.06 68.53 446.24 59.79"/><line class="cls-2" x1="443.06" y1="155.15" x2="443.06" y2="68.53"/><polygon class="cls-3" points="446.24 149.24 445.3 148.9 443.06 155.05 440.82 148.9 439.88 149.24 443.06 157.98 446.24 149.24"/><line class="cls-2" x1="443.06" y1="199.2" x2="443.06" y2="157.98"/><polygon class="cls-3" points="446.24 193.29 445.3 192.95 443.06 199.1 440.82 192.95 439.88 193.29 443.06 202.03 446.24 193.29"/><line class="cls-2" x1="443.06" y1="342.35" x2="443.06" y2="202.03"/><polygon class="cls-3" points="446.24 336.44 445.3 336.1 443.06 342.25 440.82 336.1 439.88 336.44 443.06 345.18 446.24 336.44"/><line class="cls-2" x1="443.06" y1="390.17" x2="443.06" y2="345.18"/><polygon class="cls-3" points="446.24 384.26 445.3 383.92 443.06 390.07 440.82 383.92 439.88 384.26 443.06 393 446.24 384.26"/><line class="cls-2" x1="443.06" y1="502.31" x2="443.06" y2="393"/><polygon class="cls-3" points="446.24 496.39 445.3 496.05 443.06 502.21 440.82 496.05 439.88 496.39 443.06 505.13 446.24 496.39"/><line class="cls-2" x1="443.06" y1="551.84" x2="443.06" y2="505.13"/><polygon class="cls-3" points="446.24 545.93 445.3 545.59 443.06 551.74 440.82 545.59 439.88 545.93 443.06 554.66 446.24 545.93"/><line class="cls-2" x1="716.81" y1="277.67" x2="716.81" y2="258.29"/><polygon class="cls-3" points="719.99 271.76 719.05 271.41 716.8 277.57 714.57 271.41 713.63 271.76 716.8 280.49 719.99 271.76"/><line class="cls-2" x1="716.81" y1="322.54" x2="716.81" y2="280.49"/><polygon class="cls-3" points="719.99 316.63 719.05 316.29 716.8 322.44 714.57 316.29 713.63 316.63 716.8 325.36 719.99 316.63"/><line class="cls-2" x1="716.81" y1="417.23" x2="716.81" y2="325.36"/><polygon class="cls-3" points="719.99 411.31 719.05 410.97 716.8 417.13 714.57 410.97 713.63 411.31 716.8 420.05 719.99 411.31"/><line class="cls-2" x1="716.81" y1="466.1" x2="716.81" y2="420.05"/><polygon class="cls-3" points="719.99 460.19 719.05 459.84 716.8 466 714.57 459.84 713.63 460.19 716.8 468.92 719.99 460.19"/><line class="cls-2" x1="716.81" y1="506.98" x2="716.81" y2="468.92"/><polygon class="cls-3" points="719.99 501.07 719.05 500.72 716.8 506.88 714.57 500.72 713.63 501.07 716.8 509.8 719.99 501.07"/><line class="cls-2" x1="716.81" y1="551.84" x2="716.81" y2="509.8"/><polygon class="cls-3" points="719.99 545.93 719.05 545.59 716.8 551.74 714.57 545.59 713.63 545.93 716.8 554.66 719.99 545.93"/><rect class="cls-4" x="345.62" y="345.18" width="194.88" height="22.67"/><text class="cls-5" transform="translate(355.79 360.34)">pwm ← <tspan class="cls-6" x="44.89" y="0">停止 PWM</tspan><tspan x="99.71" y="0" xml:space="preserve"> × sgn( pwm )</tspan></text><rect class="cls-4" x="407.96" y="505.13" width="70.2" height="22.67"/><text class="cls-5" transform="translate(417.2 520.3)">pwm ← 0</text><rect class="cls-4" x="362.33" y="157.98" width="161.46" height="22.67"/><text class="cls-5" transform="translate(370.9 173.14)">pwm ← 100 × sgn( pwm )</text><polygon class="cls-4" points="573.49 266.57 444.1 327.31 312.63 262.24 442.01 201.51 573.49 266.57"/><text class="cls-5" transform="translate(364.85 253.84)">abs( curr_rev ) &lt; <tspan class="cls-6" x="97.43" y="0">停止回転数</tspan></text><text class="cls-5" transform="translate(374.36 286.17)">abs( pwm ) &gt; <tspan class="cls-6" x="78.42" y="0">停止 PWM</tspan></text><text class="cls-5" transform="translate(430.06 270)">かつ</text><polygon class="cls-4" points="539.39 440.89 444.15 485.6 347.37 437.7 442.61 393 539.39 440.89"/><text class="cls-5" transform="translate(369.02 441.9)">abs( angle_diff ) &lt; <tspan class="cls-6" x="104.71" y="0">許容誤差</tspan></text><polygon class="cls-4" points="518.31 106.07 443.66 141.11 367.81 103.57 442.46 68.53 518.31 106.07"/><text class="cls-5" transform="translate(395.62 107.23)">abs( pwm ) &gt; 100</text><text class="cls-5" transform="translate(439.64 570.53)">2</text><circle class="cls-2" cx="443.06" cy="567" r="12.33"/><text class="cls-5" transform="translate(439.83 43.87)">1</text><circle class="cls-2" cx="443.06" cy="40.33" r="12.33"/><rect class="cls-4" x="679.39" y="420.05" width="74.83" height="22.67"/><text class="cls-5" transform="translate(690.95 435.22)">pwm ← 0</text><polygon class="cls-4" points="791.96 362.85 717.41 397.85 641.66 360.36 716.2 325.36 791.96 362.85"/><text class="cls-8" transform="translate(673.31 364.55)"><tspan class="cls-9">比例ゲイン</tspan><tspan class="cls-10" x="55" y="0" xml:space="preserve"> == 0</tspan></text><text class="cls-5" transform="translate(713.39 570.53)">3</text><circle class="cls-2" cx="716.81" cy="567" r="12.33"/><text class="cls-5" transform="translate(257.31 273.62)">3</text><circle class="cls-2" cx="260.73" cy="270.09" r="12.33"/><text class="cls-5" transform="translate(713.58 249.49)">2</text><circle class="cls-2" cx="716.81" cy="245.95" r="12.33"/><rect class="cls-4" x="626.59" y="280.49" width="181.25" height="22.67"/><line class="cls-4" x1="638.31" y1="280.49" x2="638.31" y2="303.16"/><line class="cls-4" x1="796.69" y1="280.49" x2="796.69" y2="303.16"/><text class="cls-5" transform="translate(647.49 295.66)">smoothen_pwm_change()</text><rect class="cls-4" x="666.84" y="468.92" width="99.83" height="22.67"/><line class="cls-4" x1="678.56" y1="468.92" x2="678.56" y2="491.59"/><line class="cls-4" x1="756.19" y1="468.92" x2="756.19" y2="491.59"/><text class="cls-5" transform="translate(685.31 484.09)">check_pol()</text><rect class="cls-4" x="655.96" y="509.8" width="121.65" height="22.67"/><line class="cls-4" x1="666.78" y1="509.8" x2="666.78" y2="532.47"/><line class="cls-4" x1="767.28" y1="509.83" x2="767.28" y2="532.47"/><text class="cls-5" transform="translate(672.24 524.97)">operate_motor()</text><text class="cls-11" transform="translate(148.98 38.66)">start</text><path class="cls-2" d="M137.58,44.16a9,9,0,0,1,0-18h44.75a9,9,0,0,1,0,18Z"/><rect class="cls-4" x="57.24" y="503.31" width="205.43" height="22.67"/><text class="cls-5" transform="translate(64.8 518.48)">pwm ← <tspan class="cls-6" x="44.89" y="0">PWM 最大値</tspan><tspan x="110.71" y="0" xml:space="preserve"> × sgn( pwm )</tspan></text><polygon class="cls-4" points="257.83 437.05 160.74 482.63 62.08 433.8 159.17 388.23 257.83 437.05"/><text class="cls-5" transform="translate(89.89 437.84)">abs( pwm ) &gt; <tspan class="cls-6" x="78.42" y="0">PWM 最大値</tspan></text><polygon class="cls-4" points="271.37 208.13 160.84 260.01 48.54 204.43 159.06 152.55 271.37 208.13"/><text class="cls-5" transform="translate(71.95 208.46)">リミットスイッチが押されているか</text><text class="cls-12" transform="translate(125.08 265.41)">YES</text><text class="cls-12" transform="translate(405.74 145.74)">YES</text><text class="cls-12" transform="translate(398.74 327.31)">YES</text><text class="cls-12" transform="translate(681.08 403.64)">YES</text><text class="cls-12" transform="translate(411.44 490.31)">YES</text><text class="cls-12" transform="translate(126.08 487.97)">YES</text><text class="cls-12" transform="translate(276.78 202.51)">NO</text><text class="cls-12" transform="translate(518.31 98.84)">NO</text><text class="cls-12" transform="translate(570.31 257.76)">NO</text><text class="cls-12" transform="translate(787.02 356.51)">NO</text><text class="cls-12" transform="translate(540.43 436.04)">NO</text><text class="cls-12" transform="translate(257.83 429.84)">NO</text><text class="cls-5" transform="translate(156.72 570.53)">1</text><circle class="cls-2" cx="159.95" cy="567" r="12.33"/><rect class="cls-4" x="99.12" y="112.2" width="121.65" height="22.67"/><line class="cls-4" x1="109.95" y1="112.2" x2="109.95" y2="134.87"/><line class="cls-4" x1="210.45" y1="112.23" x2="210.45" y2="134.87"/><text class="cls-5" transform="translate(115.4 127.36)">operate_motor()</text><polyline class="cls-2" points="271.37 208.46 306.5 208.46 306.5 54.16 162.78 54.16"/><polygon class="cls-3" points="168.69 50.98 169.03 51.92 162.88 54.16 169.03 56.41 168.69 57.34 159.95 54.16 168.69 50.98"/><polyline class="cls-2" points="257.83 437.04 294.17 437.04 294.17 536 162.78 536"/><polygon class="cls-3" points="168.69 532.82 169.03 533.76 162.88 536 169.03 538.24 168.69 539.18 159.95 536 168.69 532.82"/><polyline class="cls-2" points="518.31 106.03 559 106.03 559 189 445.88 189"/><polygon class="cls-3" points="451.8 185.82 452.14 186.76 445.98 189 452.14 191.24 451.8 192.18 443.06 189 451.8 185.82"/><polyline class="cls-2" points="573.49 266.33 589 266.33 589 377 445.88 377"/><polygon class="cls-3" points="451.8 373.82 452.14 374.76 445.98 377 452.14 379.24 451.8 380.18 443.06 377 451.8 373.82"/><polyline class="cls-2" points="539.39 440.83 565 440.83 565 538 445.88 538"/><polygon class="cls-3" points="451.8 534.82 452.14 535.76 445.98 538 452.14 540.24 451.8 541.18 443.06 538 451.8 534.82"/><polyline class="cls-2" points="791.96 362.75 816 362.75 816 451.75 719.63 451.75"/><polygon class="cls-3" points="725.54 448.57 725.88 449.51 719.73 451.75 725.88 453.99 725.54 454.93 716.8 451.75 725.54 448.57"/><text class="cls-12" transform="translate(591.5 31.97)">abs() : 引数の絶対値を返す<tspan x="0" y="15">sgn() : 引数が正のときは 1</tspan><tspan class="cls-13" x="143.36" y="15">,</tspan><tspan class="cls-14" x="150.17" y="15">負のときは -1 を返す</tspan><tspan x="0" y="30">operate_motor() : MD への信号に変更を反映する</tspan><tspan x="0" y="45">calc_encoder() : エンコーダのパルスから</tspan><tspan class="cls-1"><tspan x="0" y="60">calc_encoder() : </tspan><tspan class="cls-15" x="95.61" y="60">位置カウントと回転数を計算する</tspan></tspan><tspan x="0" y="75">smoothen_pwm_change() : pwm の加減速処理</tspan><tspan x="0" y="90">check_pol() : エンコーダの極性が正しいか確認する</tspan><tspan x="0" y="120">pwm : 出力する PWM 波形のデューティー比</tspan><tspan x="0" y="135">cur_rev : 回転数現在値</tspan><tspan x="0" y="150">angle_diff : 回転角の目標値と現在値の差</tspan><tspan x="0" y="165">cnt_diff : QEI モジュールの位置カウントの偏差</tspan><tspan x="0" y="180">　　( angle_diff と同様のものと考えて問題ない )</tspan></text><polyline class="cls-2" points="867.33 216.83 867.33 220.33 863.83 220.33"/><line class="cls-16" x1="856.76" y1="220.33" x2="591.54" y2="220.33"/><polyline class="cls-2" points="588 220.33 584.5 220.33 584.5 216.83"/><line class="cls-17" x1="584.5" y1="209.96" x2="584.5" y2="20.91"/><polyline class="cls-2" points="584.5 17.48 584.5 13.97 588 13.97"/><line class="cls-16" x1="595.07" y1="13.97" x2="860.3" y2="13.97"/><polyline class="cls-2" points="863.83 13.97 867.33 13.97 867.33 17.48"/><line class="cls-17" x1="867.33" y1="24.35" x2="867.33" y2="213.39"/><line class="cls-2" x1="248.39" y1="270.09" x2="162.78" y2="270.09"/><polygon class="cls-3" points="168.69 266.91 169.03 267.85 162.88 270.09 169.03 272.33 168.69 273.27 159.95 270.09 168.69 266.91"/><rect class="cls-4" x="100.98" y="288.69" width="117.97" height="22.67"/><line class="cls-4" x1="111.65" y1="288.69" x2="111.65" y2="311.36"/><line class="cls-4" x1="209.06" y1="288.69" x2="209.06" y2="311.36"/><text class="cls-5" transform="translate(120.13 303.86)">calc_encoder()</text><rect class="cls-4" x="80.27" y="70.85" width="159.35" height="22.67"/><text class="cls-5" transform="translate(88.02 86.01)">pwm ← <tspan class="cls-6" x="44.89" y="0">ゼロ点合わせ PWM</tspan></text><polyline class="cls-18" points="312.63 245.99 312.63 249.49 309.13 249.49"/><line class="cls-19" x1="302.07" y1="249.49" x2="51.53" y2="249.49"/><polyline class="cls-18" points="48 249.49 44.5 249.49 44.5 245.99"/><line class="cls-20" x1="44.5" y1="238.8" x2="44.5" y2="55.43"/><polyline class="cls-18" points="44.5 51.83 44.5 48.33 48 48.33"/><line class="cls-19" x1="55.06" y1="48.33" x2="305.6" y2="48.33"/><polyline class="cls-18" points="309.13 48.33 312.63 48.33 312.63 51.83"/><line class="cls-20" x1="312.63" y1="59.02" x2="312.63" y2="242.39"/><polyline class="cls-18" points="571.5 203.5 571.5 207 568 207"/><line class="cls-21" x1="560.9" y1="207" x2="351.55" y2="207"/><polyline class="cls-18" points="348 207 344.5 207 344.5 203.5"/><line class="cls-22" x1="344.5" y1="196.64" x2="344.5" y2="62.93"/><polyline class="cls-18" points="344.5 59.5 344.5 56 348 56"/><line class="cls-21" x1="355.1" y1="56" x2="564.45" y2="56"/><polyline class="cls-18" points="568 56 571.5 56 571.5 59.5"/><line class="cls-22" x1="571.5" y1="66.35" x2="571.5" y2="200.07"/><polyline class="cls-18" points="597 378.5 597 382 593.5 382"/><line class="cls-23" x1="586.49" y1="382" x2="337.51" y2="382"/><polyline class="cls-18" points="334 382 330.5 382 330.5 378.5"/><line class="cls-24" x1="330.5" y1="371.59" x2="330.5" y2="236.95"/><polyline class="cls-18" points="330.5 233.5 330.5 230 334 230"/><line class="cls-23" x1="341.01" y1="230" x2="589.99" y2="230"/><polyline class="cls-18" points="593.5 230 597 230 597 233.5"/><line class="cls-24" x1="597" y1="240.4" x2="597" y2="375.05"/><polyline class="cls-18" points="579.17 539.5 579.17 543 575.67 543"/><line class="cls-25" x1="568.61" y1="543" x2="346.2" y2="543"/><polyline class="cls-18" points="342.67 543 339.17 543 339.17 539.5"/><line class="cls-26" x1="339.17" y1="532.48" x2="339.17" y2="409.67"/><polyline class="cls-18" points="339.17 406.16 339.17 402.66 342.67 402.66"/><line class="cls-25" x1="349.73" y1="402.66" x2="572.14" y2="402.66"/><polyline class="cls-18" points="575.67 402.66 579.17 402.66 579.17 406.16"/><line class="cls-26" x1="579.17" y1="413.18" x2="579.17" y2="535.99"/><polyline class="cls-18" points="829.5 453 829.5 456.5 826 456.5"/><line class="cls-27" x1="818.99" y1="456.5" x2="640.17" y2="456.5"/><polyline class="cls-18" points="636.67 456.5 633.17 456.5 633.17 453"/><line class="cls-28" x1="633.17" y1="445.74" x2="633.17" y2="318.79"/><polyline class="cls-18" points="633.17 315.16 633.17 311.66 636.67 311.66"/><line class="cls-27" x1="643.68" y1="311.66" x2="822.49" y2="311.66"/><polyline class="cls-18" points="826 311.66 829.5 311.66 829.5 315.16"/><line class="cls-28" x1="829.5" y1="322.42" x2="829.5" y2="449.37"/><polyline class="cls-18" points="305.5 538.5 305.5 542 302 542"/><line class="cls-29" x1="295.14" y1="542" x2="51.43" y2="542"/><polyline class="cls-18" points="48 542 44.5 542 44.5 538.5"/><line class="cls-30" x1="44.5" y1="531.21" x2="44.5" y2="389.14"/><polyline class="cls-18" points="44.5 385.5 44.5 382 48 382"/><line class="cls-29" x1="54.86" y1="382" x2="298.57" y2="382"/><polyline class="cls-18" points="302 382 305.5 382 305.5 385.5"/><line class="cls-30" x1="305.5" y1="392.78" x2="305.5" y2="534.85"/><text class="cls-31" transform="translate(50.06 63.75)">A</text><text class="cls-31" transform="translate(15 353.37)">B</text><text class="cls-31" transform="translate(50.37 397.85)">C</text><text class="cls-31" transform="translate(351.05 73.53)">D</text><text class="cls-31" transform="translate(335.25 244.8)">E</text><text class="cls-31" transform="translate(346.75 422.05)">F</text><text class="cls-31" transform="translate(640.31 327.36)">H</text><text class="cls-31" transform="translate(655.59 483.86)">I</text><text class="cls-31" transform="translate(614.5 294.86)">G</text></svg>