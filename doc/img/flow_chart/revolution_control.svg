<svg id="レイヤー_1" data-name="レイヤー 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 881.33 595.28"><defs><style>.cls-1,.cls-2{fill:#fff;}.cls-17,.cls-18,.cls-2,.cls-7{stroke:#231815;}.cls-17,.cls-18,.cls-19,.cls-2,.cls-20,.cls-21,.cls-22,.cls-23,.cls-24,.cls-25,.cls-26,.cls-27,.cls-28,.cls-29,.cls-7{stroke-miterlimit:10;}.cls-10,.cls-3,.cls-4,.cls-9{font-size:11px;}.cls-10,.cls-13,.cls-15,.cls-16,.cls-3,.cls-4,.cls-8,.cls-9{fill:#231815;}.cls-10,.cls-3,.cls-6{font-family:Meiryo, Meiryo;}.cls-32,.cls-33,.cls-4{font-family:Meiryo-BoldItalic, Meiryo;}.cls-30,.cls-32,.cls-5{font-weight:700;}.cls-32,.cls-5{font-style:italic;text-decoration:underline;}.cls-17,.cls-18,.cls-19,.cls-20,.cls-21,.cls-22,.cls-23,.cls-24,.cls-25,.cls-26,.cls-27,.cls-28,.cls-29,.cls-7{fill:none;}.cls-9{font-family:KozGoPr6N-Regular-90ms-RKSJ-H, Kozuka Gothic Pr6N;}.cls-10{letter-spacing:0.02em;}.cls-11{letter-spacing:0.27em;}.cls-12,.cls-13{letter-spacing:0.02em;}.cls-14,.cls-15{letter-spacing:-0.48em;}.cls-16{letter-spacing:-0.48em;}.cls-17{stroke-dasharray:7.07 7.07;}.cls-18{stroke-dasharray:6.98 6.98;}.cls-19,.cls-20,.cls-21,.cls-22,.cls-23,.cls-24,.cls-25,.cls-26,.cls-27,.cls-28,.cls-29{stroke:#e60012;stroke-width:0.5px;}.cls-20{stroke-dasharray:7.09 7.09;}.cls-21{stroke-dasharray:6.78 6.78;}.cls-22{stroke-dasharray:7.13 7.13;}.cls-23{stroke-dasharray:7.02 7.02;}.cls-24{stroke-dasharray:7.14 7.14;}.cls-25{stroke-dasharray:7.21 7.21;}.cls-26{stroke-dasharray:7.23 7.23;}.cls-27{stroke-dasharray:6.98 6.98;}.cls-28{stroke-dasharray:6.85 6.85;}.cls-29{stroke-dasharray:6.73 6.73;}.cls-30{font-size:12px;fill:#e60012;font-family:Meiryo-Bold, Meiryo;}.cls-31{letter-spacing:2.93em;}</style></defs><title>アートボード 1</title><rect class="cls-1" width="881.33" height="595.28"/><rect class="cls-2" x="409.87" y="217.52" width="70.2" height="22.67"/><text class="cls-3" transform="translate(419.11 232.68)">pwm ← 0</text><rect class="cls-2" x="407.35" y="374.87" width="74.83" height="22.67"/><text class="cls-3" transform="translate(418.91 390.03)">pwm ← 0</text><polygon class="cls-2" points="520.71 317.27 446.16 352.27 370.41 314.78 444.96 279.78 520.71 317.27"/><text class="cls-4" transform="translate(413.06 318.97)"><tspan class="cls-5">有効化</tspan><tspan class="cls-6" x="33" y="0" xml:space="preserve"> == 0</tspan></text><rect class="cls-2" x="394.65" y="442.13" width="99.83" height="22.67"/><line class="cls-2" x1="406.38" y1="442.13" x2="406.38" y2="464.8"/><line class="cls-2" x1="484.01" y1="442.13" x2="484.01" y2="464.8"/><text class="cls-3" transform="translate(413.12 457.3)">check_pol()</text><rect class="cls-2" x="383.54" y="498.4" width="121.65" height="22.67"/><line class="cls-2" x1="394.36" y1="498.4" x2="394.36" y2="521.06"/><line class="cls-2" x1="494.86" y1="498.43" x2="494.86" y2="521.06"/><text class="cls-3" transform="translate(399.82 513.56)">operate_motor()</text><line class="cls-7" x1="443.34" y1="83.11" x2="443.34" y2="51.47"/><polygon class="cls-8" points="446.52 77.2 445.58 76.86 443.34 83.01 441.1 76.86 440.16 77.2 443.34 85.94 446.52 77.2"/><line class="cls-7" x1="445.06" y1="187.09" x2="445.06" y2="87.13"/><polygon class="cls-8" points="448.24 181.18 447.3 180.84 445.06 186.99 442.82 180.84 441.88 181.18 445.06 189.92 448.24 181.18"/><line class="cls-7" x1="445.06" y1="214.69" x2="445.06" y2="189.92"/><polygon class="cls-8" points="448.24 208.78 447.3 208.44 445.06 214.59 442.82 208.44 441.88 208.78 445.06 217.52 448.24 208.78"/><line class="cls-7" x1="445.06" y1="277.01" x2="445.06" y2="240.18"/><polygon class="cls-8" points="448.24 271.1 447.3 270.75 445.06 276.91 442.82 270.75 441.88 271.1 445.06 279.83 448.24 271.1"/><line class="cls-7" x1="445.07" y1="372.04" x2="445.12" y2="351.75"/><polygon class="cls-8" points="448.26 366.14 447.32 365.79 445.07 371.94 442.84 365.78 441.9 366.12 445.06 374.87 448.26 366.14"/><line class="cls-7" x1="445.06" y1="439.31" x2="445.06" y2="397.53"/><polygon class="cls-8" points="448.24 433.39 447.3 433.05 445.06 439.21 442.82 433.05 441.88 433.39 445.06 442.13 448.24 433.39"/><line class="cls-7" x1="445.06" y1="495.57" x2="445.06" y2="464.8"/><polygon class="cls-8" points="448.24 489.66 447.3 489.32 445.06 495.48 442.82 489.32 441.88 489.66 445.06 498.4 448.24 489.66"/><line class="cls-7" x1="445.06" y1="551.84" x2="445.06" y2="521.06"/><polygon class="cls-8" points="448.24 545.93 447.3 545.59 445.06 551.74 442.82 545.59 441.88 545.93 445.06 554.66 448.24 545.93"/><text class="cls-3" transform="translate(441.95 570.53)">2</text><circle class="cls-7" cx="445.36" cy="567" r="12.33"/><text class="cls-3" transform="translate(440.22 42.67)">1</text><circle class="cls-7" cx="443.45" cy="39.14" r="12.33"/><text class="cls-3" transform="translate(257.31 57.04)">2</text><circle class="cls-7" cx="260.73" cy="53.51" r="12.33"/><text class="cls-9" transform="translate(149.14 38.66)">start</text><path class="cls-7" d="M137.74,44.16a9,9,0,0,1,0-18h44.75a9,9,0,0,1,0,18Z"/><text class="cls-10" transform="translate(416.83 359.23)">YES</text><text class="cls-10" transform="translate(413.12 197.02)">YES</text><text class="cls-10" transform="translate(520.71 311.66)">NO</text><text class="cls-10" transform="translate(551.64 133.91)">NO</text><text class="cls-3" transform="translate(156.8 570.53)">1</text><circle class="cls-7" cx="160.03" cy="567" r="12.33"/><text class="cls-10" transform="translate(591.5 31.97)">abs() : 引数の絶対値を返す<tspan x="0" y="15">sgn() : 引数が正のときは 1</tspan><tspan class="cls-11" x="143.36" y="15">,</tspan><tspan class="cls-12" x="150.17" y="15">負のときは -1 を返す</tspan><tspan x="0" y="30">calc_encoder() : エンコーダのパルスから</tspan><tspan class="cls-1"><tspan x="0" y="45">calc_encoder() : </tspan><tspan class="cls-13" x="95.61" y="45">回転数を計算する</tspan></tspan><tspan x="0" y="60">check_pol() : エンコーダの極性が正しいか確認する</tspan><tspan x="0" y="75">operate_motor() : MD への信号に変更を反映する</tspan><tspan x="0" y="90">inform_err() : エラーが発生したことを知らせる</tspan><tspan class="cls-14" x="250.65" y="90">．</tspan><tspan class="cls-1"><tspan x="0" y="105">inform_err() : </tspan><tspan class="cls-8" x="82.35" y="105">具体的にはモータを停止して</tspan><tspan class="cls-15" x="228.21" y="105">，</tspan><tspan x="0" y="120">inform_err() : </tspan><tspan class="cls-8" x="82.35" y="120">LED を周期的に点滅させる</tspan><tspan class="cls-16" x="220.32" y="120">．</tspan></tspan><tspan x="0" y="150">pwm : 出力する PWM 波形のデューティー比</tspan><tspan x="0" y="165">pre_pwm : 前回の pwm</tspan><tspan x="0" y="180">tgt_rev : 回転数目標値</tspan><tspan x="0" y="195">curr_rev : 回転数現在値</tspan><tspan x="0" y="210">rev_diff : 回転数の目標値と現在値の差</tspan><tspan x="0" y="225">err_cnt : エラーが連続で発生した回数</tspan></text><polyline class="cls-7" points="867.33 261.75 867.33 265.25 863.83 265.25"/><line class="cls-17" x1="856.76" y1="265.25" x2="591.54" y2="265.25"/><polyline class="cls-7" points="588 265.25 584.5 265.25 584.5 261.75"/><line class="cls-18" x1="584.5" y1="254.77" x2="584.5" y2="20.96"/><polyline class="cls-7" points="584.5 17.48 584.5 13.97 588 13.97"/><line class="cls-17" x1="595.07" y1="13.97" x2="860.3" y2="13.97"/><polyline class="cls-7" points="863.83 13.97 867.33 13.97 867.33 17.48"/><line class="cls-18" x1="867.33" y1="24.45" x2="867.33" y2="258.26"/><line class="cls-7" x1="248.39" y1="53.51" x2="162.78" y2="53.51"/><polygon class="cls-8" points="168.69 50.33 169.03 51.27 162.88 53.51 169.03 55.75 168.69 56.69 159.95 53.51 168.69 50.33"/><polyline class="cls-19" points="269.25 327.33 269.25 330.83 265.75 330.83"/><line class="cls-20" x1="258.66" y1="330.83" x2="77.8" y2="330.83"/><polyline class="cls-19" points="74.25 330.83 70.75 330.83 70.75 327.33"/><line class="cls-21" x1="70.75" y1="320.56" x2="70.75" y2="188.39"/><polyline class="cls-19" points="70.75 185 70.75 181.5 74.25 181.5"/><line class="cls-20" x1="81.34" y1="181.5" x2="262.2" y2="181.5"/><polyline class="cls-19" points="265.75 181.5 269.25 181.5 269.25 185"/><line class="cls-21" x1="269.25" y1="191.78" x2="269.25" y2="323.94"/><polyline class="cls-19" points="308.67 531 308.67 534.5 305.17 534.5"/><line class="cls-22" x1="298.03" y1="534.5" x2="30.57" y2="534.5"/><polyline class="cls-19" points="27 534.5 23.5 534.5 23.5 531"/><line class="cls-23" x1="23.5" y1="523.98" x2="23.5" y2="345.01"/><polyline class="cls-19" points="23.5 341.5 23.5 338 27 338"/><line class="cls-22" x1="34.13" y1="338" x2="301.6" y2="338"/><polyline class="cls-19" points="305.17 338 308.67 338 308.67 341.5"/><line class="cls-23" x1="308.67" y1="348.52" x2="308.67" y2="527.49"/><polyline class="cls-19" points="573.5 255 573.5 258.5 570 258.5"/><line class="cls-24" x1="562.86" y1="258.5" x2="338.07" y2="258.5"/><polyline class="cls-19" points="334.5 258.5 331 258.5 331 255"/><line class="cls-25" x1="331" y1="247.79" x2="331" y2="78.36"/><polyline class="cls-19" points="331 74.75 331 71.25 334.5 71.25"/><line class="cls-24" x1="341.64" y1="71.25" x2="566.43" y2="71.25"/><polyline class="cls-19" points="570 71.25 573.5 71.25 573.5 74.75"/><line class="cls-25" x1="573.5" y1="81.96" x2="573.5" y2="251.4"/><polyline class="cls-19" points="549.75 415.25 549.75 418.75 546.25 418.75"/><line class="cls-26" x1="539.02" y1="418.75" x2="369.04" y2="418.75"/><polyline class="cls-19" points="365.42 418.75 361.92 418.75 361.92 415.25"/><line class="cls-27" x1="361.92" y1="408.27" x2="361.92" y2="272.24"/><polyline class="cls-19" points="361.92 268.75 361.92 265.25 365.42 265.25"/><line class="cls-26" x1="372.65" y1="265.25" x2="542.63" y2="265.25"/><polyline class="cls-19" points="546.25 265.25 549.75 265.25 549.75 268.75"/><line class="cls-27" x1="549.75" y1="275.73" x2="549.75" y2="411.76"/><polyline class="cls-19" points="828.33 469.83 828.33 473.33 824.83 473.33"/><line class="cls-28" x1="817.98" y1="473.33" x2="588.43" y2="473.33"/><polyline class="cls-19" points="585 473.33 581.5 473.33 581.5 469.83"/><line class="cls-29" x1="581.5" y1="463.1" x2="581.5" y2="318.32"/><polyline class="cls-19" points="581.5 314.95 581.5 311.45 585 311.45"/><line class="cls-28" x1="591.85" y1="311.45" x2="821.41" y2="311.45"/><polyline class="cls-19" points="824.83 311.45 828.33 311.45 828.33 314.95"/><line class="cls-29" x1="828.33" y1="321.68" x2="828.33" y2="466.47"/><text class="cls-30" transform="translate(16.26 149.46)">A</text><text class="cls-30" transform="translate(80.64 203.72)">B</text><text class="cls-30" transform="translate(34.52 358.31)">C</text><text class="cls-30" transform="translate(373.25 285.67)">E</text><text class="cls-30" transform="translate(341.02 92.89)">D</text><text class="cls-30" transform="translate(378.85 457.47)">F</text><text class="cls-30" transform="translate(590.89 330.97)">G</text><text class="cls-30" transform="translate(620.58 515.56)">H</text><text class="cls-30" transform="translate(858.7 545.3)">I</text><text class="cls-30" transform="matrix(-1, 0, 0, 1, 627.26, 383.31)">H</text><line class="cls-7" x1="159.95" y1="493.48" x2="159.95" y2="551.84"/><polygon class="cls-8" points="156.77 545.93 157.71 545.59 159.95 551.74 162.19 545.59 163.13 545.93 159.95 554.66 156.77 545.93"/><line class="cls-7" x1="159.95" y1="349.39" x2="159.95" y2="490.66"/><polygon class="cls-8" points="156.77 484.74 157.71 484.4 159.95 490.56 162.19 484.4 163.13 484.74 159.95 493.48 156.77 484.74"/><line class="cls-7" x1="159.95" y1="289.98" x2="159.95" y2="346.57"/><polygon class="cls-8" points="156.77 340.66 157.71 340.31 159.95 346.47 162.19 340.31 163.13 340.66 159.95 349.39 156.77 340.66"/><line class="cls-7" x1="159.95" y1="197.02" x2="159.95" y2="287.15"/><polygon class="cls-8" points="156.77 281.24 157.71 280.9 159.95 287.06 162.19 280.9 163.13 281.24 159.95 289.98 156.77 281.24"/><line class="cls-7" x1="159.95" y1="123.87" x2="159.95" y2="194.19"/><polygon class="cls-8" points="156.77 188.28 157.71 187.94 159.95 194.09 162.19 187.94 163.13 188.28 159.95 197.02 156.77 188.28"/><line class="cls-7" x1="159.95" y1="72.68" x2="159.95" y2="121.04"/><polygon class="cls-8" points="156.77 115.13 157.71 114.79 159.95 120.94 162.19 114.79 163.13 115.13 159.95 123.86 156.77 115.13"/><line class="cls-7" x1="159.95" y1="43.87" x2="159.95" y2="69.86"/><polygon class="cls-8" points="156.77 63.94 157.71 63.6 159.95 69.76 162.19 63.6 163.13 63.94 159.95 72.68 156.77 63.94"/><rect class="cls-2" x="101.22" y="72.68" width="117.97" height="22.67"/><line class="cls-2" x1="111.88" y1="72.68" x2="111.88" y2="95.35"/><line class="cls-2" x1="209.3" y1="72.68" x2="209.3" y2="95.35"/><text class="cls-3" transform="translate(120.37 87.85)">calc_encoder()</text><rect class="cls-2" x="37.1" y="123.87" width="245.71" height="44.5"/><text class="cls-3" transform="translate(46.33 139.36)">pwm ← pre_pwm + ( tgt_rev - curr_rev )<tspan class="cls-31" x="0" y="19.25" xml:space="preserve">		</tspan><tspan x="72" y="19.25">× </tspan><tspan class="cls-32" x="84.58" y="19.25">比例ゲイン</tspan><tspan x="139.58" y="19.25" xml:space="preserve"> × 0.01</tspan></text><polygon class="cls-2" points="235.53 234.42 160.88 269.46 85.03 231.92 159.68 196.88 235.53 234.42"/><text class="cls-3" transform="translate(112.84 235.58)">abs( pwm ) &gt; 100</text><polyline class="cls-7" points="235.53 234.42 259 234.42 259 325.43 163.19 325.43"/><polygon class="cls-8" points="169.1 322.25 169.44 323.19 163.29 325.43 169.44 327.67 169.1 328.61 160.37 325.43 169.1 322.25"/><rect class="cls-2" x="79.64" y="289.98" width="161.46" height="22.67"/><text class="cls-3" transform="translate(88.2 305.14)">pwm ← 100 × sgn( pwm )</text><polygon class="cls-2" points="290.96 414.23 161.57 474.96 30.1 409.9 159.49 349.16 290.96 414.23"/><text class="cls-3" transform="translate(82.32 401.49)">abs( curr_rev ) &lt; <tspan class="cls-32" x="97.43" y="0">停止回転数</tspan></text><text class="cls-3" transform="translate(91.83 433.82)">abs( pwm ) &gt; <tspan class="cls-32" x="78.42" y="0">停止 PWM</tspan></text><text class="cls-3" transform="translate(147.53 417.66)">かつ</text><rect class="cls-2" x="63.01" y="493.48" width="194.88" height="22.67"/><text class="cls-3" transform="translate(73.18 508.65)">pwm ← <tspan class="cls-32" x="44.89" y="0">停止 PWM</tspan><tspan x="99.71" y="0" xml:space="preserve"> × sgn( pwm )</tspan></text><polyline class="cls-7" points="290.96 414.23 303 414.23 303 527.33 162.78 527.33"/><polygon class="cls-8" points="168.69 524.15 169.03 525.09 162.88 527.33 169.03 529.57 168.69 530.51 159.95 527.33 168.69 524.15"/><polygon class="cls-2" points="551.64 139.88 445.03 189.92 336.7 136.31 443.31 86.26 551.64 139.88"/><text class="cls-3" transform="translate(390.11 131.5)">abs( rev_diff ) &lt; 10<tspan x="42.25" y="16">かつ</tspan><tspan x="17.77" y="32">tgt_rev == 0</tspan></text><polyline class="cls-7" points="551.64 139.88 562.67 139.88 562.67 252.95 448.38 252.95"/><polygon class="cls-8" points="454.3 249.77 454.64 250.71 448.48 252.95 454.64 255.19 454.3 256.13 445.56 252.95 454.3 249.77"/><polyline class="cls-7" points="520.71 317.27 540.67 317.27 540.67 412.06 448.38 412.06"/><polygon class="cls-8" points="454.3 408.88 454.64 409.82 448.48 412.06 454.64 414.3 454.3 415.24 445.56 412.06 454.3 408.88"/><rect class="cls-2" x="752.23" y="530.13" width="98.7" height="22.67"/><line class="cls-2" x1="763.06" y1="530.13" x2="763.06" y2="552.8"/><line class="cls-2" x1="841.06" y1="530.16" x2="841.06" y2="552.8"/><text class="cls-3" transform="translate(768.16 545.3)">inform_err()</text><text class="cls-9" transform="translate(647.41 569.47)">check_pol() 終了</text><path class="cls-7" d="M741.2,575H646.11a9,9,0,1,1,0-18h94.75a9,9,0,0,1,0,18Z"/><text class="cls-9" transform="translate(647.4 299.87)">check_pol() 開始</text><path class="cls-7" d="M741.19,305.38H646.1a9,9,0,0,1,0-18h94.75a9,9,0,0,1,0,18Z"/><line class="cls-7" x1="693.47" y1="486.56" x2="693.47" y2="554.14"/><polygon class="cls-8" points="690.29 548.23 691.23 547.89 693.47 554.04 695.71 547.89 696.65 548.23 693.47 556.97 690.29 548.23"/><line class="cls-7" x1="693.47" y1="439.61" x2="693.47" y2="483.73"/><polygon class="cls-8" points="690.29 477.82 691.23 477.48 693.47 483.63 695.71 477.48 696.65 477.82 693.47 486.56 690.29 477.82"/><line class="cls-7" x1="693.48" y1="323.14" x2="693.48" y2="435.06"/><polygon class="cls-8" points="690.3 429.15 691.24 428.81 693.48 434.96 695.73 428.81 696.66 429.15 693.48 437.88 690.3 429.15"/><line class="cls-7" x1="693.47" y1="305.37" x2="693.47" y2="322.03"/><polygon class="cls-8" points="690.29 316.12 691.23 315.78 693.47 321.94 695.71 315.78 696.65 316.12 693.47 324.86 690.29 316.12"/><rect class="cls-2" x="657.6" y="437.88" width="71.74" height="22.67"/><text class="cls-3" transform="translate(665.23 453.05)">err_cnt++</text><polygon class="cls-2" points="798.3 376.73 694.32 425.54 588.67 373.25 692.64 324.44 798.3 376.73"/><text class="cls-3" transform="translate(620.44 372.24)">abs( pwm ) &gt; <tspan class="cls-32" x="78.42" y="0">PWM 最大値</tspan><tspan x="61.13" y="12">かつ</tspan><tspan class="cls-33"><tspan class="cls-5" x="41.97" y="24">有効化</tspan><tspan class="cls-6" x="74.97" y="24" xml:space="preserve"> != 1</tspan></tspan></text><polygon class="cls-2" points="746.93 513.01 693.91 537.9 640.03 511.23 693.05 486.34 746.93 513.01"/><text class="cls-3" transform="translate(662.5 515.14)">err_cnt &gt; 3</text><polyline class="cls-7" points="798.3 376.73 816.98 376.73 816.98 468.3 696.31 468.3"/><polygon class="cls-8" points="702.22 465.12 702.56 466.06 696.41 468.3 702.56 470.54 702.22 471.48 693.48 468.3 702.22 465.12"/><polyline class="cls-7" points="746.93 513.01 804.59 513.01 804.59 527.31"/><polygon class="cls-8" points="801.41 521.4 802.35 521.05 804.59 527.21 806.83 521.05 807.77 521.4 804.59 530.13 801.41 521.4"/></svg>