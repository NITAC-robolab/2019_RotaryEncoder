<svg id="レイヤー_1" data-name="レイヤー 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 880.67 579"><defs><style>.cls-1,.cls-2{fill:#fff;}.cls-15,.cls-16,.cls-2,.cls-5{stroke:#231815;}.cls-15,.cls-16,.cls-2,.cls-21,.cls-22,.cls-23,.cls-24,.cls-25,.cls-5{stroke-miterlimit:10;}.cls-3,.cls-4,.cls-6{font-size:11px;}.cls-13,.cls-14,.cls-3,.cls-4,.cls-6,.cls-7,.cls-8{fill:#231815;}.cls-20,.cls-3,.cls-6{font-family:Meiryo, Meiryo;}.cls-4{font-family:KozGoPr6N-Regular-90ms-RKSJ-H, Kozuka Gothic Pr6N;}.cls-15,.cls-16,.cls-21,.cls-22,.cls-23,.cls-24,.cls-25,.cls-5{fill:none;}.cls-10,.cls-6{letter-spacing:0.02em;}.cls-11,.cls-8{letter-spacing:-0.48em;}.cls-9{letter-spacing:2.93em;}.cls-12,.cls-14{letter-spacing:-0.48em;}.cls-13{letter-spacing:0.02em;}.cls-15{stroke-dasharray:7.05 7.05;}.cls-16{stroke-dasharray:6.95 6.95;}.cls-17,.cls-18{font-family:Meiryo-BoldItalic, Meiryo;}.cls-17,.cls-19,.cls-26{font-weight:700;}.cls-17,.cls-19{font-style:italic;text-decoration:underline;}.cls-21,.cls-22,.cls-23,.cls-24,.cls-25{stroke:#e60012;stroke-width:0.5px;}.cls-22{stroke-dasharray:6.95 6.95;}.cls-23{stroke-dasharray:7.22 7.22;}.cls-24{stroke-dasharray:6.84 6.84;}.cls-25{stroke-dasharray:6.74 6.74;}.cls-26{font-size:12px;fill:#e60012;font-family:Meiryo-Bold, Meiryo;}</style></defs><title>アートボード 1</title><rect class="cls-1" width="880.67" height="579"/><rect class="cls-2" x="516.65" y="518.67" width="98.7" height="22.67"/><line class="cls-2" x1="527.47" y1="518.67" x2="527.47" y2="541.33"/><line class="cls-2" x1="605.47" y1="518.7" x2="605.47" y2="541.33"/><text class="cls-3" transform="translate(532.58 533.83)">inform_err()</text><text class="cls-4" transform="translate(388.9 80.91)">check_pol() 開始</text><path class="cls-5" d="M482.69,86.41H387.59a9,9,0,0,1,0-18h94.75a9,9,0,0,1,0,18Z"/><text class="cls-6" transform="translate(652 36.38)">abs() : 引数の絶対値を返す<tspan x="0" y="15">sgn() : 引数が正のときは 1,</tspan><tspan class="cls-1"><tspan x="0" y="30">sig() : </tspan><tspan class="cls-7" x="38.58" y="30">負のときは -1 を返す</tspan><tspan class="cls-8" x="148.36" y="30">．</tspan></tspan><tspan x="0" y="45">inform_err() :</tspan><tspan class="cls-9"><tspan x="0" y="60">	</tspan><tspan class="cls-10" x="36" y="60">エラーが発生したことを知らせる</tspan><tspan class="cls-11" x="204.3" y="60">．</tspan><tspan x="0" y="75">	</tspan><tspan class="cls-10" x="36" y="75">具体的にはモータを停止して</tspan><tspan class="cls-11" x="181.86" y="75">，</tspan><tspan x="0" y="90">	</tspan><tspan class="cls-10" x="36" y="90">LED を周期的に点滅させる</tspan><tspan class="cls-12" x="173.97" y="90">．</tspan></tspan><tspan x="0" y="120">max_change :</tspan><tspan class="cls-9"><tspan x="0" y="135">	</tspan><tspan class="cls-10" x="36" y="135">許容するデューティー比の</tspan><tspan x="0" y="150">	</tspan><tspan class="cls-10" x="36" y="150">変化量の最大値</tspan></tspan><tspan x="0" y="165">passed_time : 前回の処理からの</tspan><tspan class="cls-1"><tspan x="0" y="180">passed_time : </tspan><tspan class="cls-13" x="83.05" y="180">経過時間．単位は秒</tspan><tspan class="cls-14" x="184.03" y="180">．</tspan></tspan><tspan x="0" y="195">pwm_change : デューティー比の変化量</tspan><tspan x="0" y="210">pwm : 出力する PWM 波形の</tspan><tspan class="cls-1"><tspan x="0" y="225">pwm : </tspan><tspan class="cls-7" x="39.93" y="225">デューティー比</tspan></tspan><tspan x="0" y="240">pre_pwm : 前回の pwm</tspan><tspan x="0" y="270">diff_change : 回転角偏差の変化量</tspan><tspan x="0" y="285">angle_diff : 今回の回転角の目標値と</tspan><tspan class="cls-1"><tspan x="0" y="300">angle_diff : </tspan><tspan class="cls-13" x="67.54" y="300">現在値の差（回転角偏差</tspan><tspan class="cls-14" x="190.96" y="300">）</tspan></tspan><tspan x="0" y="315">pre_angle_diff :</tspan><tspan class="cls-9"><tspan x="0" y="330">	</tspan><tspan class="cls-10" x="36" y="330">前回の回転角偏差</tspan></tspan><tspan x="0" y="345">err_cnt : エラーが連続で発生した回数</tspan></text><polyline class="cls-5" points="866.83 390.5 866.83 394 863.33 394"/><line class="cls-15" x1="856.28" y1="394" x2="648.18" y2="394"/><polyline class="cls-5" points="644.66 394 641.16 394 641.16 390.5"/><line class="cls-16" x1="641.16" y1="383.55" x2="641.16" y2="25.83"/><polyline class="cls-5" points="641.16 22.35 641.16 18.85 644.66 18.85"/><line class="cls-15" x1="651.71" y1="18.85" x2="859.81" y2="18.85"/><polyline class="cls-5" points="863.33 18.85 866.83 18.85 866.83 22.35"/><line class="cls-16" x1="866.83" y1="29.3" x2="866.83" y2="387.03"/><text class="cls-4" transform="translate(78.94 30.92)">smoothen_pwn_change() 開始</text><path class="cls-5" d="M238.56,18.44h1.84a9,9,0,1,1,0,17.94h.05"/><path class="cls-5" d="M238.56,18.44H74.87a9,9,0,0,0,0,18H240.4"/><line class="cls-5" x1="152.88" y1="382.93" x2="152.88" y2="459.35"/><polygon class="cls-7" points="149.69 453.44 150.63 453.09 152.88 459.25 155.12 453.09 156.06 453.44 152.88 462.17 149.69 453.44"/><line class="cls-5" x1="152.88" y1="227.7" x2="152.88" y2="380.1"/><polygon class="cls-7" points="149.69 374.19 150.63 373.85 152.88 380 155.12 373.85 156.06 374.19 152.88 382.93 149.69 374.19"/><line class="cls-5" x1="152.88" y1="160.66" x2="152.88" y2="224.87"/><polygon class="cls-7" points="149.69 218.96 150.63 218.62 152.88 224.78 155.12 218.62 156.06 218.96 152.88 227.7 149.69 218.96"/><line class="cls-5" x1="152.88" y1="80.18" x2="152.88" y2="157.83"/><polygon class="cls-7" points="149.69 151.92 150.63 151.58 152.88 157.74 155.12 151.58 156.06 151.92 152.88 160.66 149.69 151.92"/><line class="cls-5" x1="152.88" y1="36.38" x2="152.88" y2="77.35"/><polygon class="cls-7" points="149.69 71.44 150.63 71.1 152.88 77.26 155.12 71.1 156.06 71.44 152.88 80.18 149.69 71.44"/><line class="cls-5" x1="435.17" y1="465.26" x2="435.17" y2="535.17"/><polygon class="cls-7" points="431.99 529.26 432.93 528.92 435.17 535.08 437.41 528.92 438.35 529.26 435.17 538 431.99 529.26"/><line class="cls-5" x1="435.17" y1="418.04" x2="435.17" y2="462.44"/><polygon class="cls-7" points="431.99 456.53 432.93 456.19 435.17 462.34 437.41 456.19 438.35 456.53 435.17 465.26 431.99 456.53"/><line class="cls-5" x1="435.17" y1="313.37" x2="435.17" y2="415.14"/><polygon class="cls-7" points="431.99 409.23 432.93 408.89 435.17 415.05 437.41 408.89 438.35 409.23 435.17 417.97 431.99 409.23"/><line class="cls-5" x1="435.17" y1="266.92" x2="435.17" y2="310.55"/><polygon class="cls-7" points="431.99 304.64 432.93 304.29 435.17 310.45 437.41 304.29 438.35 304.64 435.17 313.37 431.99 304.64"/><line class="cls-5" x1="435.17" y1="118.34" x2="435.17" y2="264.09"/><polygon class="cls-7" points="431.99 258.18 432.93 257.84 435.17 263.99 437.41 257.84 438.35 258.18 435.17 266.92 431.99 258.18"/><line class="cls-5" x1="435.17" y1="57.64" x2="435.17" y2="115.52"/><polygon class="cls-7" points="431.99 109.61 432.93 109.26 435.17 115.42 437.41 109.26 438.35 109.61 435.17 118.34 431.99 109.61"/><line class="cls-5" x1="435.17" y1="36.25" x2="435.17" y2="54.82"/><polygon class="cls-7" points="431.99 48.91 432.93 48.56 435.17 54.72 437.41 48.56 438.35 48.91 435.17 57.64 431.99 48.91"/><rect class="cls-2" x="26.99" y="80.18" width="251.29" height="36.68"/><text class="cls-3" transform="translate(35.81 94.93)">max_change<tspan class="cls-9" x="0" y="12">	</tspan><tspan x="36" y="12">← </tspan><tspan class="cls-17" x="50.74" y="12">PWM 変化量最大値</tspan><tspan x="149.57" y="12" xml:space="preserve"> × passed_time</tspan></text><rect class="cls-2" x="55.17" y="160.66" width="194.93" height="22.67"/><text class="cls-3" transform="translate(63.79 175.82)">pwm_change ← pwm - pre_pwm</text><polygon class="cls-2" points="268.77 285.05 153.57 339.13 36.51 281.2 151.71 227.12 268.77 285.05"/><text class="cls-3" transform="translate(55.32 285.23)">abs( pwm_change ) &gt; max_change</text><rect class="cls-2" x="26.84" y="382.93" width="251.59" height="35.45"/><text class="cls-3" transform="translate(34 397.06)">pwm ← pre_pwm <tspan class="cls-9" x="0" y="12">	</tspan><tspan x="36" y="12">+ max_change × sgn( pwm_change )</tspan></text><rect class="cls-2" x="295.4" y="57.64" width="279.14" height="38.83"/><text class="cls-3" transform="translate(302.84 72.47)">diff_change<tspan class="cls-9" x="0" y="14">	</tspan><tspan x="36" y="14">← abs( angle_diff ) - abs( pre_angle_diff )</tspan></text><rect class="cls-2" x="399.1" y="267.02" width="71.74" height="22.67"/><text class="cls-3" transform="translate(406.72 282.18)">err_cnt++</text><rect class="cls-2" x="395.6" y="418.05" width="78.73" height="22.67"/><text class="cls-3" transform="translate(402.91 433.22)">err_cnt ← 0</text><polygon class="cls-2" points="569.83 184.99 436.05 247.78 300.11 180.51 433.89 117.71 569.83 184.99"/><text class="cls-3" transform="translate(393.25 155.15)">diff_change &gt; 0<tspan x="31.71" y="12">かつ</tspan><tspan class="cls-18"><tspan class="cls-19" x="1.55" y="24">比例ゲイン</tspan><tspan class="cls-20" x="56.55" y="24" xml:space="preserve"> != 0</tspan></tspan><tspan x="31.71" y="36">かつ</tspan><tspan x="-33.83" y="48">abs( pwm ) == </tspan><tspan class="cls-17" x="53.43" y="48">PWM 最大値</tspan></text><polygon class="cls-2" points="525.07 357.86 435.69 399.82 344.87 354.87 434.25 312.92 525.07 357.86"/><text class="cls-3" transform="translate(378.49 358.78)">pwn × pre_pwm &lt; 0</text><polygon class="cls-2" points="488.42 491.62 435.4 516.51 381.52 489.84 434.54 464.95 488.42 491.62"/><text class="cls-3" transform="translate(403.99 493.75)">err_cnt &gt; 3</text><polyline class="cls-5" points="268.77 285.09 305.5 284.83 305.5 440.72 155.99 440.72"/><polygon class="cls-7" points="161.9 437.54 162.25 438.48 156.09 440.72 162.25 442.96 161.9 443.9 153.17 440.72 161.9 437.54"/><text class="cls-6" transform="translate(118.24 346.39)">YES</text><text class="cls-6" transform="translate(403.24 254.14)">YES</text><text class="cls-6" transform="translate(403.24 406.81)">YES</text><text class="cls-6" transform="translate(270.16 278.35)">NO</text><text class="cls-6" transform="translate(571.66 177.68)">NO</text><text class="cls-6" transform="translate(524.33 351.01)">NO</text><polyline class="cls-5" points="580.25 228.47 580.25 297.67 437.49 297.67"/><polygon class="cls-7" points="443.4 294.49 443.75 295.43 437.59 297.67 443.75 299.91 443.4 300.85 434.67 297.67 443.4 294.49"/><polyline class="cls-5" points="569.83 184.99 580.25 184.99 580.25 225.64"/><polygon class="cls-7" points="577.07 219.73 578.01 219.39 580.25 225.55 582.49 219.39 583.43 219.73 580.25 228.47 577.07 219.73"/><rect class="cls-2" x="540.93" y="228.55" width="78.73" height="22.67"/><text class="cls-3" transform="translate(548.23 243.72)">err_cnt ← 0</text><polyline class="cls-5" points="525.07 357.86 546 357.86 546 449 437.83 449"/><polygon class="cls-7" points="443.74 445.82 444.08 446.76 437.92 449 444.08 451.24 443.74 452.18 435 449 443.74 445.82"/><polyline class="cls-5" points="488.42 491.62 566.25 491.62 566.25 515.17"/><polygon class="cls-7" points="563.07 509.26 564.01 508.92 566.25 515.08 568.49 508.92 569.43 509.26 566.25 518 563.07 509.26"/><text class="cls-4" transform="translate(74.18 475.01)">smoothen_pwn_change() 終了</text><path class="cls-5" d="M233.8,462.53h1.84a9,9,0,0,1,0,17.94h.05"/><path class="cls-5" d="M233.8,462.53H70.11a9,9,0,0,0,0,18H235.64"/><text class="cls-4" transform="translate(388.9 550.5)">check_pol() 終了</text><path class="cls-5" d="M482.69,556H387.59a9,9,0,0,1,0-18h94.75a9,9,0,0,1,0,18Z"/><text class="cls-4" transform="translate(388.9 30.91)">check_pol() 開始</text><path class="cls-5" d="M482.69,36.41H387.59a9,9,0,0,1,0-18h94.75a9,9,0,1,1,0,18Z"/><polyline class="cls-21" points="625.33 299.17 625.33 302.67 621.83 302.67"/><line class="cls-22" x1="614.88" y1="302.67" x2="340.31" y2="302.67"/><polyline class="cls-21" points="336.83 302.67 333.33 302.67 333.33 299.17"/><line class="cls-23" x1="333.33" y1="291.95" x2="333.33" y2="136.78"/><polyline class="cls-21" points="333.33 133.17 333.33 129.67 336.83 129.67"/><line class="cls-22" x1="343.78" y1="129.67" x2="618.36" y2="129.67"/><polyline class="cls-21" points="621.83 129.67 625.33 129.67 625.33 133.17"/><line class="cls-23" x1="625.33" y1="140.38" x2="625.33" y2="295.56"/><polyline class="cls-21" points="568.67 450.5 568.67 454 565.17 454"/><line class="cls-24" x1="558.33" y1="454" x2="342.92" y2="454"/><polyline class="cls-21" points="339.5 454 336 454 336 450.5"/><line class="cls-25" x1="336" y1="443.76" x2="336" y2="325.87"/><polyline class="cls-21" points="336 322.5 336 319 339.5 319"/><line class="cls-24" x1="346.34" y1="319" x2="561.75" y2="319"/><polyline class="cls-21" points="565.17 319 568.67 319 568.67 322.5"/><line class="cls-25" x1="568.67" y1="329.24" x2="568.67" y2="447.13"/><text class="cls-26" transform="translate(366.88 495.75)">L</text><text class="cls-26" transform="translate(622.89 535.83)">M</text><text class="cls-26" transform="translate(343.26 146)">J</text><text class="cls-26" transform="translate(344.51 336.67)">K</text></svg>